# 総合管理システム ガイドブック

## 目次

* **序章：はじめに**
* **第一章：日常業務**
    * 1-1. ライブ出席状況の確認 (`live-dashboard.html`)
    * 1-2. 終業時の出席漏れ一括処理 (`batch-process.html`)
* **第二章：生徒情報の管理 (`users.html`)**
* **第三章：授業スケジュールの管理**
    * 3-1. 振替の新規登録 (`schedule.html`)
    * 3-2. 全スケジュールの管理 (`schedule-admin.html`)
* **第四章：マスターデータの管理**
    * 4-1. PCの管理 (`pcs.html`)
    * 4-2. 授業コマの管理 (`class-slots.html`)
* **第五章：システム管理**
    * 5-1. ログインとログアウト
    * 5-2. データのエクスポートとインポート (`backup.html`)
* **終章：トラブルシューティング**

---

### **第一章：日常業務**

この章では、日々の授業運営中や業務の終わりに利用する、中心的な機能について解説します。

---

#### **1-1. ライブ出席状況の確認 (`live-dashboard.html`)**

**【目的】**
現在進行中の授業について、「誰が出席予定か」「実際に出席しているか」をリアルタイムで把握するための、メインの監視画面です。

**【アクセス方法】**
ログイン後、ポータルページの「ライブ出席状況」からアクセスします。
* **直接URL:** `http://localhost:3000/live-dashboard.html`

**【主な機能】**
* 現在時刻に該当する授業名と時間を自動で表示します。
* その授業に出席予定の生徒を、カード形式で一覧表示します。
* 各生徒の出欠状況が、カードの色（出席済みは緑、未入室はオレンジ）で視覚的にわかります。
* 「出席を記録」ボタンで、手動で生徒を入室済みにできます。
* 「出席を取り消し」ボタンで、誤って記録した出席を取り消せます。
* 「欠席にする」ボタンで、その日の授業を「欠席」として確定できます。
* 画面は15秒ごとに自動で最新情報に更新されます。

**【操作手順】**
* **出席させる場合:** 未入室（オレンジ色）の生徒カードにある「**出席を記録**」ボタンをクリックします。
* **欠席させる場合:** 未入室（オレンジ色）の生徒カードにある「**欠席にする**」ボタンをクリックします。
* **出席を取り消す場合:** 出席済み（緑色）の生徒カードにある「**出席を取り消し**」ボタンをクリックします。

**【注意点・ヒント】**
* 「**出席を取り消し**」は、誤操作を元に戻す機能です。スケジュール上のステータスは変わりません。
* 「**欠席にする**」は、その日のスケジュールを「欠席」として確定する機能です。実行すると生徒はライブダッシュボードから消えます。

---

#### **1-2. 終業時の出席漏れ一括処理 (`batch-process.html`)**

**【目的】**
QRコードの読み取り忘れなどで入室記録がない生徒を、一日の終わりにまとめて処理するための画面です。その日に「出席予定だったが、記録がない」生徒だけをリストアップします。

**【アクセス方法】**
ログイン後、ポータルページの「出席漏れ一括処理」などのリンクからアクセスします。
* **直接URL:** `http://localhost:3000/batch-process.html`

**【主な機能】**
* 特定の日付を指定して、出席記録のない生徒を一覧表示します。
* ボタン一つで、対象者を出席または欠席として記録できます。

**【操作手順】**
1.  画面上部の日付選択カレンダーで、確認したい日付を選択します。（初期状態では今日の日付が選択されています）
2.  「**表示**」ボタンをクリックすると、対象者が一覧で表示されます。
3.  各生徒の行の右側にあるボタンで、処理を確定します。
    * **実は出席していた場合:** 「**出席として記録**」ボタンをクリックします。
    * **やはり欠席だった場合:** 「**欠席として記録**」ボタンをクリックします。

**【注意点・ヒント】**
* ボタンを押して処理が成功すると、その生徒は一覧から消えます。最終的に一覧が空になることが、その日の処理完了の目安となります。

---

### **第二章：生徒情報の管理 (`users.html`)**

**【目的】**
この画面は、塾に所属する全ての生徒の情報を一元管理するための中心的な機能です。生徒の新規追加、既存情報の更新、削除、そして各生徒の基本となる通常授業のスケジュール設定など、生徒情報に関する全ての操作をここで行います。

**【アクセス方法】**
ログイン後、ポータルページの「ユーザー管理」リンクからアクセスします。
* **直接URL:** `http://localhost:3000/users.html`

**【主な機能】**
* 新規生徒の登録
* 全生徒の一覧表示
* 既存生徒の情報（名前、級、メールアドレス、希望PC）の編集
* 生徒情報の削除
* 生徒ごとの通常授業スケジュールの一括設定

**【操作手順】**
* **新規登録:** 画面上部の「新規ユーザー登録」フォームに情報を入力し、「登録する」ボタンをクリックします。
* **編集:** 一覧から対象の生徒を探し、右端の「**編集**」ボタンをクリックします。表示されたウィンドウで内容を修正し、「保存」ボタンを押します。
* **スケジュール設定:** 右端の「**スケジュール設定**」ボタンをクリックします。表示されたウィンドウで通常授業のコマや期間を指定し、「一括登録」ボタンを押します。
* **削除:** 右端の「**削除**」ボタンをクリックします。確認ダイアログが表示された後、完全に削除されます。

**【注意点・ヒント】**
* **ユーザーID**は、一度登録すると後から変更できません。
* 生徒を削除すると、関連する全てのスケジュールと入退室ログも削除されます。**この操作は元に戻すことができない**ため、ご注意ください。

### **第三章：授業スケジュールの管理**

この章では、生徒の日々の出席予定や、イレギュラーな振替を管理するための、高度な機能について解説します。

---

#### **3-1. 振替の新規登録 (`schedule.html`)**

**【目的】**
この画面は、特定の生徒が、本来の授業を欠席し、別の授業に「振替」として参加する予定を登録するために使用します。

**【アクセス方法】**
`schedule-admin.html`のページ上部にある「振替登録画面へ」のリンクなどからアクセスします。
* **直接URL:** `http://localhost:3000/schedule.html`

**【主な機能】**
* 名前やIDで、振替を行いたい生徒を検索・選択できます。
* 欠席する「元の授業」の日付とコマを指定します。
* 参加する「振替先の授業」の日付とコマを指定します。
* 振替先のコマの現在の出席予定者を確認できます。

**【操作手順】**
1.  **生徒の選択:** 画面上部の検索窓に生徒の名前（一部でも可）を入力し、「検索」ボタンを押します。表示された候補の中から、対象の生徒をクリックします。
2.  **元の授業の指定:** 「元の授業（欠席にする）」セクションで、生徒が休む授業の「日付」を選択します。すると、その日に予定されている通常授業が「コマ」のドロップダウンに表示されるので、対象のコマを選択します。
3.  **振替先の授業の指定:** 「振替先の授業」セクションで、振替として参加する授業の「日付」を選択します。すると、その曜日に存在するコマが「コマ」のドロップダウンに表示されるので、対象のコマを選択します。
4.  **登録の実行:** 「この内容で振替を登録」ボタンを押すと、元の授業が「欠席」に、新しい授業が「振替」としてデータベースに記録されます。

**【注意点・ヒント】**
* この操作を行うと、元の授業のステータスは自動的に「欠席」に更新されます。別途欠席処理を行う必要はありません。

---

#### **3-2. 全スケジュールの管理 (`schedule-admin.html`)**

**【目的】**
全ての生徒の、全てのスケジュール（通常、振替、欠席）を一覧で確認し、検索・編集・削除・新規追加を行う、最も強力な管理画面です。

**【アクセス方法】**
ログイン後、ポータルページの「全スケジュール管理」からアクセスします。
* **直接URL:** `http://localhost:3000/schedule-admin.html`

**【主な機能】**
* 日付範囲、生徒名、ステータス（通常、振替、欠席）でスケジュールを絞り込み表示できます。
* 既存のスケジュールの情報を（日付、コマ、ステータス、備考など）を編集できます。
* 不要になったスケジュールを削除できます。
* 振替や臨時の授業などを、手動で新規追加できます。

**【操作手順】**
1.  **絞り込み:** 画面上部の「表示フィルタ」に条件を入力し、「表示」ボタンを押すと、下の一覧が更新されます。
2.  **新規追加:** 「＋ 新規授業予定を追加」ボタンを押すと、モーダルウィンドウが開きます。生徒、日付、コマなどを選択して、新しいスケジュールを直接作成できます。
3.  **編集 / 削除:** 一覧の各行の右端にある「編集」または「削除」ボタンで、個別のスケジュールを操作します。

**【注意点・ヒント】**
* 振替や欠席の間違いを修正する際は、この画面の「編集」機能を使うのが最も簡単です。

---
### **第四章：マスターデータの管理**

この章では、システムの基礎となる情報（PCや授業コマ）を管理する方法について解説します。

---

#### **4-1. PCの管理 (`pcs.html`)**

**【目的】**
塾で使用する全てのパソコンを台帳として登録・管理するための画面です。

**【アクセス方法】**
ログイン後、ポータルページの「PC管理」からアクセスします。
* **直接URL:** `http://localhost:3000/pcs.html`

**【主な機能】**
* 新しいPCの登録（ID、名前、備考）
* 既存PCの一覧表示
* 既存PCの削除

**【操作手順】**
* **追加:** 画面上部の「新規PC追加」フォームに情報を入力し、「追加」ボタンを押します。
* **削除:** 一覧の右端にある「削除」ボタンを押します。

**【注意点・ヒント】**
* ここで登録したPCが、「ユーザー管理」画面の「希望PC」ドロップダウンなどに表示されます。
* PCを削除しても、既にそのPCが割り当てられている生徒の「希望PC」設定は自動では解除されません。必要に応じて、ユーザー管理画面で再設定してください。

---

#### **4-2. 授業コマの管理 (`class-slots.html`)**

**【目的】**
塾の基本的な時間割、「月曜1限」「火曜2限」といった「授業の枠」を定義・管理するための画面です。

**【アクセス方法】**
ログイン後、ポータルページの「授業コマ管理」からアクセスします。
* **直接URL:** `http://localhost:3000/class-slots.html`

**【主な機能】**
* 新しい授業コマの登録（コマ名、曜日、時限、開始・終了時刻）
* 既存コマの一覧表示
* 既存コマの削除

**【操作手順】**
* **追加:** 画面上部の「新規コマ追加」フォームに情報を入力し、「追加」ボタンを押します。
* **削除:** 一覧の右端にある「削除」ボタンを押します。

**【注意点・ヒント】**
* **【最重要警告】** コマを削除すると、そのコマに紐づく**全てのスケジュール（過去・未来の通常授業や振替の記録）も、連鎖してデータベースから完全に削除されます。** この操作は元に戻せないため、コマの削除は細心の注意を払って行ってください。
### **第五章：システム管理**

この章では、システム全体のデータを保護し、管理するための重要な機能について解説します。

---

#### **5-1. ログインとログアウト**

**【目的】**
権限のない第三者によるアクセスを防ぎ、システムの安全性を確保します。

**【操作手順】**
* **ログイン:** `http://localhost:3000/login.html`にアクセスし、`create-admin.js`で設定した管理者ユーザー名とパスワードを入力して「ログイン」ボタンを押します。
* **ログアウト:** 各画面のヘッダーや、ポータルページにある「ログアウト」ボタンを押します。

**【注意点・ヒント】**
* ログインセッションは24時間有効です。
* パスワードを忘れた場合は、`management.db`ファイルを一度削除し、再度`create-admin.js`を実行して管理者アカウントを再作成するのが最も確実です。

---

#### **5-2. データのエクスポートとインポート (`backup.html`)**

**【目的】**
データベース全体のバックアップを作成したり、バックアップからデータを復元したりするための機能です。システムの移行や、万が一の事態に備えます。

**【アクセス方法】**
ログイン後、ポータルページの「データ管理」などのリンクからアクセスします。
* **直接URL:** `http://localhost:3000/backup.html`

**【主な機能】**
* 全てのテーブルのデータを、CSV形式でZIPファイルとしてエクスポート（ダウンロード）します。
* ZIP形式のバックアップファイルから、全データをインポート（復元）します。

**【操作手順】**
* **エクスポート:** 「エクスポート実行」ボタンを押すだけです。`backup-(日時).zip`という名前のファイルがダウンロードされます。
* **インポート:** 「ファイルを選択」ボタンで、以前エクスポートしたZIPファイルを選び、「インポート実行」ボタンを押します。

**【最重要警告】**
* **インポート操作は、現在のデータベースにある全てのデータを完全に削除し、アップロードしたファイルの内容で上書きします。** この操作は**絶対に元に戻せません。** 操作を行う前には、必ずエクスポート機能で現在のデータのバックアップを取るようにしてください。

---
### **終章：トラブルシューティング**

問題が発生した際に、原因を特定するための基本的な手引きです。

---

#### **エラー1：画面が真っ白、または「Cannot GET /...」と表示される**
* **原因:** サーバー(`server.js`)が起動していないか、URLのタイプミスです。
* **対策:** ターミナルで`node server.js`を実行し、サーバーを起動してください。URLが正しいか確認してください。

#### **エラー2：「JSON.parse: unexpected character...」と表示される**
* **原因:** フロントエンドがAPIからJSON形式のデータを期待していたのに、サーバーがHTML（主にエラーページ）を返したことを示します。根本的な原因は、APIへのリクエストが失敗していることです。
* **対策:** ブラウザのデベロッパーツール（F12キー）を開き、「Console」タブや「Network」タブを確認してください。`404 (Not Found)`や`500 (Internal Server Error)`といった、失敗したAPI通信が記録されているはずです。その情報が、真の原因を特定する鍵となります。

#### **エラー3：ボタンを押しても無反応、画面の一部が正しく表示されない**
* **原因:** HTMLとJavaScriptの間で、IDの指定ミスや、コードのバージョンが古いなどの不整合が起きている可能性が高いです。
* **対策:** 最新のソースコードが正しく反映されているか確認してください。ブラウザのキャッシュが原因のこともあるため、スーパーリロード（`Ctrl+Shift+R`または`Cmd+Shift+R`）を試してみてください。

#### **エラー4：データベース関連のエラー（`SQLITE_...`など）**
* **原因:** データベースのルール（IDの重複禁止など）に違反する操作を行おうとしたか、データベースファイルのスキーマ（構造）が古いことが原因です。
* **対策:** 入力データが正しいか確認してください。大きな機能追加後は、一度`management.db`ファイルを削除し、サーバーを再起動してデータベースを再生成すると解決することがあります。